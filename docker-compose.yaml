version: "3"
services:
  proxy:
    image: traefik:v2.5
    container_name: proxy
    restart: unless-stopped
    networks:
      - fre
      - default
    ports:
      - "${PROXY_PORT}:80"
      - 8080:8080
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./config/traefik.yml:/etc/traefik/traefik.yml
    labels:
      - traefik.http.routers.api.rule=Host(`traefik.${DOMAIN}`)
      - traefik.http.routers.api.service=api@internal
  file-server:
    image: filebrowser/filebrowser:s6
    container_name: file-server
    restart: unless-stopped
    networks:
      - fre
    ports:
      - 8081:80
    volumes:
      - ./config/filebrowser.json:/config/settings.json
      - ./data/users:/srv
      - file_db:/database
    labels:
      - traefik.http.routers.file-server.rule=Host(`files.${DOMAIN}`)

volumes:
  file_db:
  code:

networks:
  fre:
  default:
